<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test - Guess Validation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Integration Test - Guess Validation and Scoring</h1>
    <div id="test-results"></div>
    <div id="game-info"></div>
    
    <button onclick="testCorrectGuess()">Test Correct Guess</button>
    <button onclick="testIncorrectGuess()">Test Incorrect Guess</button>
    <button onclick="showGameState()">Show Game State</button>

    <script>
        const resultsDiv = document.getElementById('test-results');
        const gameInfoDiv = document.getElementById('game-info');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }

        // Mock game state for testing
        let mockGameState = {
            cityRoute: ['tokyo', 'london', 'roma', 'sydney', 'buenosAires'],
            currentCityIndex: 0,
            currentCity: 'tokyo',
            currentClueLevel: 'hard',
            gameStats: {
                score: 0,
                attemptsRemaining: 3,
                citiesVisited: 1
            },
            getNextCityInRoute() {
                if (this.currentCityIndex >= this.cityRoute.length - 1) {
                    return null;
                }
                return this.cityRoute[this.currentCityIndex + 1];
            },
            advanceToNextCity() {
                if (this.currentCityIndex < this.cityRoute.length - 1) {
                    this.currentCityIndex++;
                    this.currentCity = this.cityRoute[this.currentCityIndex];
                    this.gameStats.citiesVisited++;
                }
            }
        };

        // Mock game controller methods
        function validateGuessAgainstRoute(cityId) {
            const nextCityInRoute = mockGameState.getNextCityInRoute();
            
            if (!nextCityInRoute) {
                return {
                    isCorrect: false,
                    reason: 'no_next_city',
                    message: 'No next destination in route'
                };
            }

            const isCorrect = cityId === nextCityInRoute;
            
            return {
                isCorrect: isCorrect,
                expectedCity: nextCityInRoute,
                guessedCity: cityId,
                reason: isCorrect ? 'correct_destination' : 'incorrect_destination',
                message: isCorrect ? 
                    'Correct destination! Following the trail perfectly.' : 
                    'Incorrect destination. Nadine wasn\'t here.'
            };
        }

        function awardPointsForCorrectGuess() {
            const currentClueLevel = mockGameState.currentClueLevel || 'easy';
            
            const pointValues = {
                'hard': 3,
                'medium': 2,
                'easy': 1
            };
            
            const points = pointValues[currentClueLevel] || 1;
            mockGameState.gameStats.score += points;
            
            return points;
        }

        function testCorrectGuess() {
            addResult('=== Testing Correct Guess ===', 'info');
            
            const nextCity = mockGameState.getNextCityInRoute();
            addResult(`Next city in route: ${nextCity}`, 'info');
            
            const guessResult = validateGuessAgainstRoute(nextCity);
            addResult(`Guess result: ${guessResult.message}`, guessResult.isCorrect ? 'pass' : 'fail');
            
            if (guessResult.isCorrect) {
                const pointsAwarded = awardPointsForCorrectGuess();
                addResult(`Points awarded: ${pointsAwarded}`, 'pass');
                
                mockGameState.advanceToNextCity();
                addResult(`Advanced to: ${mockGameState.currentCity}`, 'pass');
            }
            
            showGameState();
        }

        function testIncorrectGuess() {
            addResult('=== Testing Incorrect Guess ===', 'info');
            
            const guessResult = validateGuessAgainstRoute('invalid_city');
            addResult(`Guess result: ${guessResult.message}`, !guessResult.isCorrect ? 'pass' : 'fail');
            
            if (!guessResult.isCorrect) {
                mockGameState.gameStats.attemptsRemaining--;
                addResult(`Attempts reduced to: ${mockGameState.gameStats.attemptsRemaining}`, 'pass');
            }
            
            showGameState();
        }

        function showGameState() {
            gameInfoDiv.innerHTML = `
                <h3>Current Game State</h3>
                <p><strong>Route:</strong> ${mockGameState.cityRoute.join(' â†’ ')}</p>
                <p><strong>Current City:</strong> ${mockGameState.currentCity} (Index: ${mockGameState.currentCityIndex})</p>
                <p><strong>Next City:</strong> ${mockGameState.getNextCityInRoute() || 'Final destination reached'}</p>
                <p><strong>Score:</strong> ${mockGameState.gameStats.score}</p>
                <p><strong>Attempts Remaining:</strong> ${mockGameState.gameStats.attemptsRemaining}</p>
                <p><strong>Cities Visited:</strong> ${mockGameState.gameStats.citiesVisited}</p>
                <p><strong>Current Clue Level:</strong> ${mockGameState.currentClueLevel}</p>
            `;
        }

        // Initialize display
        addResult('Integration test initialized. Click buttons to test functionality.', 'info');
        showGameState();
    </script>
</body>
</html>